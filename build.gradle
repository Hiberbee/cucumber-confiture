plugins {
  id("java-library")
  id("com.github.ben-manes.versions") version "0.28.0"
  id("idea")
  id("org.jetbrains.gradle.plugin.idea-ext") version "0.7"
}

group = "com.hiberbee.cucumber"
version = "1.0.0-SNAPSHOT"

repositories {
  jcenter()
}

def VERSIONS = [
  gradle  : "6.3",
  cucumber: "5.6.0",
  junit   : "5.6.1"
]

idea {
  project {
    settings {
      copyright {
        useDefault = "Hiberbee"
        profiles {
          Hiberbee {
            notice = file("LICENSE").readLines().join("\n")
          }
        }
      }
    }
    module {
      setExcludeDirs(files("gradle").toSet())
    }
  }
}

allprojects {
  group = rootProject.group
  version = rootProject.version
  apply plugin: "org.jetbrains.gradle.plugin.idea-ext"
  apply plugin: "idea"
  apply plugin: "java-library"

  tasks.withType(GenerateIdeaModule).configureEach {
    module.setExcludeDirs(files("gradle").toSet())
    module.setInheritOutputDirs(true)
    module.setDownloadJavadoc(false)
    module.setDownloadSources(true)
  }

  tasks.withType(JavaCompile).configureEach {
    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11
    it.options.setFork(true)
    it.options.setIncremental(true)
  }

  tasks.withType(Wrapper).configureEach {
    distributionType(Wrapper.DistributionType.ALL)
    gradleVersion(VERSIONS.gradle.toString())
  }

  repositories {
    jcenter()
  }

  dependencies {
    implementation platform("org.junit:junit-bom:$VERSIONS.junit")
    implementation platform("io.cucumber:cucumber-core:$VERSIONS.cucumber")
  }
}

dependencies {
  implementation(project(":functional"))

  testRuntime("org.junit.jupiter:junit-jupiter-engine")
  testRuntime("org.junit.platform:junit-platform-launcher")
  testRuntime("org.junit.platform:junit-platform-runner")
  testRuntime("org.junit.vintage:junit-vintage-engine")
}
